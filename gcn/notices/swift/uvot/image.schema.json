{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gcn.nasa.gov/schema/main/swift/uvot/image.schema.json",
  "title": "swift.uvot.image",
  "description": "GCN Notice schema for Swift UVOT image notices (packet types 72 and 79: SWIFT_UVOT_IMAGE and SWIFT_UVOT_IMAGE_PROC, aka DarkBurst, aka Genie). Covers both the raw flight image (type=72, alert_type='initial') and the ground-processed image (type=79, alert_type='update'). Both packet types share an identical word layout; the distinction is made via misc bit 2^30 (ground_generated). The bin[22-38] URL field points to the raw image FITS file in type=72 packets and to the ground-processed image FITS file in type=79 packets. The GRB position in bin[16] is in unbinned detector coordinates; its source is indicated by misc bit 2^28.",
  "type": "object",
  "allOf": [
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Alert.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/DateTime.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Pointing.schema.json" }
  ],
  "properties": {

    "alert_datetime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string indicating when this GCN notice was issued."
    },

    "alert_tense": {
      "type": "string",
      "enum": ["current", "test"],
      "description": "Indicates whether this is a real current notice ('current') or a test submission ('test'). Derived from GCN metadata."
    },

    "alert_type": {
      "type": "string",
      "enum": ["initial", "update"],
      "description": "Indicates whether this is the raw flight image notice ('initial', type=72) or the ground-processed image notice ('update', type=79). Derived from misc bit 2^30 (ground_generated): 0 = type=72 ('initial'), 1 = type=79 ('update')."
    },

    "mission": {
      "type": "string",
      "const": "Swift",
      "description": "Fixed string identifying the mission."
    },

    "instrument": {
      "type": "string",
      "const": "UVOT",
      "description": "Fixed string identifying the instrument."
    },

    "id": {
      "type": "array",
      "items": {
        "type": "integer"
      },
      "description": "BAT trigger ID number. Derived from the lower 24 bits of trig_obs_num (bin[4]). Note: the trigger ID originates from BAT even for UVOT image notices, as the initial trigger is always from BAT."
    },

    "ra_pointing": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 360.0,
      "description": "Right Ascension of the spacecraft pointing direction at the start/stop of the image integration interval, in degrees (J2000 epoch). Derived from point_ra (bin[7]) converted from 0.0001-deg units."
    },

    "dec_pointing": {
      "type": "number",
      "minimum": -90.0,
      "maximum": 90.0,
      "description": "Declination of the spacecraft pointing direction at the start/stop of the image integration interval, in degrees (J2000 epoch). Derived from point_dec (bin[8]) converted from 0.0001-deg units."
    },

    "roll": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 360.0,
      "description": "Roll angle of the target in degrees. Derived from image_roll (bin[9]) converted from 0.0001-deg units."
    },

    "observation_start": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string of the start of the UVOT CCD integration. Derived from ExpStart_tjd (bin[5]) and ExpStart_sod (bin[6])."
    },

    "exposure_id": {
      "type": "integer",
      "minimum": 0,
      "description": "Exposure ID expressed in spacecraft seconds. Derived from expo_id (bin[11])."
    },

    "filter": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "Blocked",
          "UV_Grism",
          "UVW2",
          "V",
          "UVM2",
          "Vis_Grism",
          "UVW1",
          "U",
          "Magnifier",
          "B",
          "White",
          "unknown"
        ]
      },
      "minItems": 1,
      "maxItems": 1,
      "description": "UVOT filter used for the image exposure. Decoded from the filter integer (bin[10]) via lookup table. Possible values: Blocked=0, UV_Grism=1, UVW2=2, V=3, UVM2=4, Vis_Grism=5, UVW1=6, U=7, Magnifier=8, B=9, White=10, unknown=11."
    },

    "image_extent": {
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": 0,
        "maximum": 2095
      },
      "minItems": 2,
      "maxItems": 2,
      "description": "Size of the Image subarray [width, height] in detector coordinates (range 0–2095). Derived from width (bin[14]) and height (bin[15])."
    },

    "image_offset": {
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": 0,
        "maximum": 2095
      },
      "minItems": 2,
      "maxItems": 2,
      "description": "Coordinates of pixel_zero (origin) of the Image subarray [X0, Y0] in detector coordinates (range 0–2095). Derived from X0 (bin[12]) and Y0 (bin[13])."
    },

    "n_frames": {
      "type": "integer",
      "minimum": 1,
      "description": "Total number of read-out frames that went into compiling this image. Derived from n_frames (bin[17])."
    },

    "pixel_binning": {
      "type": "string",
      "enum": [
        "1x1",
        "2x2",
        "4x4",
        "8x8",
        "16x16",
        "32x32",
        "64x64"
      ],
      "description": "Pixel binning of the image. Decoded from misc bits 2^0–2^3 (4-bit value) via lookup table. Values: 0=1x1 (no binning), 1=2x2, 2=4x4, 3=8x8, 4=16x16, 5=32x32, 6=64x64."
    },

    "grb_position": {
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": 0,
        "maximum": 2095
      },
      "minItems": 2,
      "maxItems": 2,
      "description": "Position of the GRB/transient in unbinned detector coordinates [x_pos, y_pos] (range 0–2095). Decoded from xy_grb (bin[16]) which contains two packed integers. The source of this position is indicated by grb_position_source."
    },

    "grb_position_source": {
      "type": "string",
      "enum": ["XRT", "Window"],
      "description": "Indicates the source of the GRB position stored in grb_position. Derived from misc bit 2^28: 'XRT' if set (position came from an XRT Position command), 'Window' if unset (position came from the Window Position in the Mode command)."
    },

    "watchdog_timeout": {
      "type": "boolean",
      "description": "Indicates whether this UVOT_IMAGE notice was forced out early via the watchdog timeout mechanism rather than completing normally. Derived from misc bit 2^29."
    },

    "raw_image_fits_file": {
      "type": ["string", "null"],
      "contentEncoding": "base64",
      "contentMediaType": "image/fits",
      "description": "Base64-encoded content of the raw UVOT image FITS file. Populated for the raw flight notice (type=72, misc bit 2^30 = 0) from the URL in bin[22–38]; null for the ground-processed notice (type=79, misc bit 2^30 = 1)."
    },

    "processed_image_fits_file": {
      "type": ["string", "null"],
      "contentEncoding": "base64",
      "contentMediaType": "image/fits",
      "description": "Base64-encoded content of the ground-processed UVOT image FITS file. Populated for the ground-processed notice (type=79, misc bit 2^30 = 1) from the URL in bin[22–38]; null for the raw flight notice (type=72, misc bit 2^30 = 0)."
    }

  },

  "required": [
    "alert_datetime",
    "alert_tense",
    "alert_type",
    "mission",
    "instrument",
    "id",
    "ra_pointing",
    "dec_pointing",
    "roll",
    "observation_start",
    "exposure_id",
    "filter",
    "image_extent",
    "image_offset",
    "n_frames",
    "pixel_binning",
    "grb_position",
    "grb_position_source",
    "watchdog_timeout",
    "raw_image_fits_file",
    "processed_image_fits_file"
  ],

  "additionalProperties": false
}
