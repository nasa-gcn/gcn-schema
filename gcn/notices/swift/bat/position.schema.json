{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gcn.nasa.gov/schema/main/swift/bat/position.schema.json",
  "title": "swift.bat.position",
  "description": "GCN Notice schema for Swift BAT GRB position notices (packet types 61 and 97: SWIFT_BAT_GRB_POS_ACK and SWIFT_BAT_QUICKLOOK_POSITION).",
  "type": "object",
  "properties": {

    "alert_datetime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string indicating when this GCN notice was issued."
    },

    "alert_tense": {
      "type": "string",
      "enum": ["current", "test"],
      "description": "Indicates whether this is a real current notice ('current') or a test submission ('test'). Derived from soln_status bit 2^30 (test_submit)."
    },

    "alert_type": {
      "type": "string",
      "enum": ["initial", "retraction"],
      "description": "Indicates whether this is a new position notice ('initial') or a retraction of a previously issued notice ('retraction'). Derived from soln_status bit 2^5 (def_not_grb): set to 'retraction' when the source is definitively classified as not a GRB."
    },

    "mission": {
      "type": "string",
      "const": "Swift",
      "description": "Fixed string identifying the mission."
    },

    "instrument": {
      "type": "string",
      "const": "BAT",
      "description": "Fixed string identifying the instrument."
    },

    "id": {
      "type": "array",
      "items": {
        "type": "integer"
      },
      "description": "BAT trigger ID number. Derived from the lower 24 bits of trig_obs_num (bin[4])."
    },

    "trigger_time": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string of the Swift-BAT burst trigger time. Derived from burst_tjd (bin[5]) and burst_sod (bin[6])."
    },

    "ra": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 360.0,
      "description": "Right Ascension of the burst/transient position as determined by the BAT flight software, in degrees (J2000 epoch). Derived from burst_ra (bin[7]) converted from 0.0001-deg units."
    },

    "dec": {
      "type": "number",
      "minimum": -90.0,
      "maximum": 90.0,
      "description": "Declination of the burst/transient position as determined by the BAT flight software, in degrees (J2000 epoch). Derived from burst_dec (bin[8]) converted from 0.0001-deg units."
    },

    "ra_dec_error": {
      "type": "number",
      "minimum": 0.0,
      "description": "90%-containment position error radius in degrees. Initially hardwired at 4 arcmin (0.067 deg); later made flux-dependent. Derived from burst_error (bin[11]) converted from 0.0001-deg units."
    },

    "systematic_included": {
      "type": "boolean",
      "const": false,
      "description": "Indicates whether the position error includes systematic contributions. Always False for BAT positions — the error radius is purely statistical."
    },

    "latitude": {
      "type": "number",
      "minimum": -90.0,
      "maximum": 90.0,
      "description": "Spacecraft latitude at the time of the BAT trigger, in degrees. Derived from the high-order short of lon_lat (bin[16]) converted from centi-degrees."
    },

    "longitude": {
      "type": "number",
      "minimum": -180.0,
      "maximum": 360.0,
      "description": "Spacecraft longitude at the time of the BAT trigger, in degrees. Derived from the low-order short of lon_lat (bin[16]) converted from centi-degrees."
    },

    "instrument_phi": {
      "type": "number",
      "description": "BAT instrument phi coordinate of the trigger, in degrees. Measured from the +Y-axis of the spacecraft increasing towards the -Z axis. Derived from phi (bin[12]) converted from centi-degrees."
    },

    "instrument_theta": {
      "type": "number",
      "minimum": 0.0,
      "description": "BAT instrument theta coordinate of the trigger, in degrees. Measured from the BAT boresight. Derived from theta (bin[13]) converted from centi-degrees."
    },

    "trigger_type": {
      "type": "string",
      "enum": ["image", "rate"],
      "description": "Indicates whether the BAT trigger was an image trigger ('image') or a rate trigger ('rate'). Derived from soln_status bit 2^4 (image_trig)."
    },

    "trigger_index": {
      "type": "integer",
      "description": "Row number in the BAT on-board flight software trigger table corresponding to the highest-significance successful trigger criterion. Derived from trig_index (bin[17])."
    },

    "net_count_rate": {
      "type": "number",
      "minimum": 0.0,
      "description": "Net (background-subtracted) count rate during the trigger interval, in counts accumulated over the integ_time interval. Derived from burst_flue (bin[9])."
    },

    "background_count_rate": {
      "type": "number",
      "minimum": 0.0,
      "description": "Number of events (counts) during the background interval. Derived from bkg_flue (bin[22])."
    },

    "rate_snr": {
      "type": "number",
      "minimum": 0.0,
      "description": "Signal-to-noise ratio of the rate-trigger detection, in sigma. Derived from rate_signif (bin[21]) converted from centi-sigma units."
    },

    "rate_duration": {
      "type": ["number", "null"],
      "minimum": 0.0,
      "description": "Duration of the rate-trigger sampling interval in seconds. Set to the integration time (integ_time, bin[14], in units of 4msec ticks) for rate triggers; null for image triggers."
    },

    "rate_energy_range": {
      "type": ["array", "null"],
      "items": {
        "type": "number"
      },
      "minItems": 2,
      "maxItems": 2,
      "description": "Energy range [low, high] in keV of the rate-trigger criterion (e.g. [15, 25]). Decoded from the trigger criterion index. Null for image triggers."
    },

    "image_snr": {
      "type": "number",
      "minimum": 0.0,
      "description": "Signal-to-noise ratio of the image-trigger detection, in sigma. Derived from image_signif (bin[20]) converted from centi-sigma units."
    },

    "image_duration": {
      "type": ["number", "null"],
      "minimum": 0.0,
      "description": "Duration of the image-trigger sampling interval in seconds. Set to the integration time (integ_time, bin[14], in units of 4msec ticks) for image triggers; null for rate triggers."
    },

    "image_energy_range": {
      "type": ["array", "null"],
      "items": {
        "type": "number"
      },
      "minItems": 2,
      "maxItems": 2,
      "description": "Energy range [low, high] in keV of the image-trigger criterion (e.g. [15, 25]). Decoded from the trigger criterion index. Null for rate triggers."
    },

    "classification": {
      "type": ["object", "null"],
      "description": "Dictionary of source classification probabilities. Keys are classification labels (e.g. 'known', 'unknown') and values are floats in [0, 1] summing to 1.0. Null if not derivable from the binary packet.",
      "additionalProperties": {
        "type": "number",
        "minimum": 0.0,
        "maximum": 1.0
      }
    },

    "properties": {
      "type": ["object", "null"],
      "description": "Dictionary of source property probabilities (e.g. {'NAME': 1.0, 'LGRB': 0.0, 'SGRB': 0.0}). Null if not derivable from the binary packet.",
      "additionalProperties": {
        "type": "number",
        "minimum": 0.0,
        "maximum": 1.0
      }
    },

    "background_start_time": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string of the start of the background interval. Derived from burst_tjd (bin[5]) combined with bkg_start (bin[23]). May be zero/epoch if no background interval is specified."
    },

    "background_duration": {
      "type": "number",
      "minimum": 0.0,
      "description": "Duration of the background interval in seconds. Derived from bkg_dur (bin[24]) converted from centi-seconds."
    },

    "catalog_number": {
      "type": ["integer", "null"],
      "description": "On-board catalog match ID number for the source. Only valid when soln_status bit 2^3 (flt_cat_src) is set; null otherwise. Derived from cat_num (bin[25])."
    },

    "observation_start": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "ISO 8601 datetime string of the start of the Swift observation. Not directly available in the BAT_GRB_POS binary packet; set to null."
    },

    "observation_livetime": {
      "type": ["number", "null"],
      "minimum": 0.0,
      "description": "Livetime of the Swift observation in seconds. Not directly available in the BAT_GRB_POS binary packet; set to null."
    },

    "within_10arcmin": {
      "type": "boolean",
      "description": "Indicates whether the BAT position is within 10 arcmin of a source in the catalog of sources to be blocked from automatic follow-up — i.e. Swift was already pointed at this source at the time of the trigger. Derived from misc bit 2^12."
    },

    "star_tracker_locked": {
      "type": "boolean",
      "description": "Indicates whether the StarTracker was locked at the time of the BAT trigger. True = locked; False = not locked (trigger is probably bogus). Derived from soln_status bit 2^10 (st_loss_lock) via lookup table."
    },

    "watchdog_timeout": {
      "type": ["boolean", "null"],
      "description": "Not assigned in the BAT_GRB_POS_ACK (type=61/97) packet; set to null. Present in related packet types (e.g. BAT_GRB_LC type=63) where misc bit 2^29 indicates early forced-out via the watchdog timeout mechanism."
    }

  },

  "required": [
    "alert_datetime",
    "alert_tense",
    "alert_type",
    "mission",
    "instrument",
    "id",
    "trigger_time",
    "ra",
    "dec",
    "ra_dec_error",
    "systematic_included",
    "latitude",
    "longitude",
    "instrument_phi",
    "instrument_theta",
    "trigger_type",
    "trigger_index",
    "net_count_rate",
    "background_count_rate",
    "rate_snr",
    "rate_duration",
    "rate_energy_range",
    "image_snr",
    "image_duration",
    "image_energy_range",
    "classification",
    "properties",
    "background_start_time",
    "background_duration",
    "catalog_number",
    "observation_start",
    "observation_livetime",
    "within_10arcmin",
    "star_tracker_locked",
    "watchdog_timeout"
  ],

  "additionalProperties": false
}
