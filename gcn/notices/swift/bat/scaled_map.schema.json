{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gcn.nasa.gov/schema/main/swift/bat/scaled_map.schema.json",
  "title": "swift.bat.scaled_map",
  "description": "GCN Notice schema for Swift BAT scaled map notices (packet type 64: SWIFT_BAT_SCALED_MAP). Not available to the public — Swift team only. The scaled map notice is issued when the BAT ground software has generated a sky-plane scaled map FITS file for the trigger. The map generation time (bin[5-6]) is stored in trigger_time, not the BAT burst trigger time. The spacecraft pointing direction (bin[7-8]) is stored in ra_pointing/dec_pointing, not the burst position.",
  "type": "object",
  "allOf": [
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Alert.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/DateTime.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Localization.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Pointing.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/GeoLocBase.schema.json" }
  ],
  "properties": {

    "alert_datetime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string indicating when this GCN notice was issued."
    },

    "alert_tense": {
      "type": "string",
      "enum": ["current", "test"],
      "description": "Indicates whether this is a real current notice ('current') or a test submission ('test'). Derived from soln_status bit 2^30 (test_submit). Note: soln_status is only valid when misc bit 2^24 is set, indicating it was copied from the associated BAT_POS_ACK packet."
    },

    "alert_type": {
      "type": "string",
      "enum": ["initial", "update"],
      "description": "Indicates whether this is the initial scaled map notice ('initial') or a retraction/update ('update'). Derived from soln_status bit 2^5 (def_not_grb). Only valid if misc bit 2^24 is set."
    },

    "mission": {
      "type": "string",
      "const": "Swift",
      "description": "Fixed string identifying the mission."
    },

    "instrument": {
      "type": "string",
      "const": "BAT",
      "description": "Fixed string identifying the instrument."
    },

    "id": {
      "type": "array",
      "items": {
        "type": "integer"
      },
      "description": "BAT trigger ID number. Derived from the lower 24 bits of trig_obs_num (bin[4])."
    },

    "trigger_time": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string of the time when the scaled map was generated. Derived from map_tjd (bin[5]) and map_sod (bin[6]). NOTE: this is the map generation time, NOT the BAT burst trigger time."
    },

    "ra": {
      "type": "null",
      "description": "Burst/transient Right Ascension. Not available in the BAT_SCALED_MAP packet — bin[9–13] are spare. Always null for this notice type. See ra_pointing for the spacecraft pointing direction."
    },

    "dec": {
      "type": "null",
      "description": "Burst/transient Declination. Not available in the BAT_SCALED_MAP packet — bin[9–13] are spare. Always null for this notice type. See dec_pointing for the spacecraft pointing direction."
    },

    "ra_dec_error": {
      "type": "null",
      "description": "Burst position error radius. Not available in the BAT_SCALED_MAP packet — bin[9–13] are spare. Always null for this notice type."
    },

    "systematic_included": {
      "type": "null",
      "description": "Not meaningful for this notice type as ra_dec_error is not available in the BAT_SCALED_MAP packet. Always null."
    },

    "ra_pointing": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 360.0,
      "description": "Right Ascension of the spacecraft pointing direction at the start/stop of the map integration interval, in degrees (J2000 epoch). Derived from point_ra (bin[7]) converted from 0.0001-deg units."
    },

    "dec_pointing": {
      "type": "number",
      "minimum": -90.0,
      "maximum": 90.0,
      "description": "Declination of the spacecraft pointing direction at the start/stop of the map integration interval, in degrees (J2000 epoch). Derived from point_dec (bin[8]) converted from 0.0001-deg units."
    },

    "latitude": {
      "type": "number",
      "minimum": -90.0,
      "maximum": 90.0,
      "description": "Spacecraft latitude at the time of the BAT trigger, in degrees. Derived from the high-order short of lon_lat (bin[16]) converted from centi-degrees."
    },

    "longitude": {
      "type": "number",
      "minimum": -180.0,
      "maximum": 360.0,
      "description": "Spacecraft longitude at the time of the BAT trigger, in degrees. Derived from the low-order short of lon_lat (bin[16]) converted from centi-degrees."
    },

    "trigger_type": {
      "type": "string",
      "enum": ["image", "rate"],
      "description": "Indicates whether the BAT trigger was an image trigger ('image') or a rate trigger ('rate'). Derived from soln_status bit 2^4 (image_trig). Only valid if misc bit 2^24 is set."
    },

    "rate_snr": {
      "type": "number",
      "minimum": 0.0,
      "description": "Signal-to-noise ratio of the rate-trigger detection in sigma, copied from the associated BAT_Position notice. Derived from rate_signif (bin[21]) converted from centi-sigma units."
    },

    "image_snr": {
      "type": "number",
      "minimum": 0.0,
      "description": "Signal-to-noise ratio of the image-trigger detection in sigma, copied from the associated BAT_Position notice. Derived from image_signif (bin[20]) converted from centi-sigma units."
    },

    "observation_start": {
      "type": "null",
      "description": "Start time of the Swift follow-up observation. Not derivable from the BAT_SCALED_MAP binary packet; always null."
    },

    "scaled_map_fits_file": {
      "type": "string",
      "contentEncoding": "base64",
      "contentMediaType": "image/fits",
      "description": "Base64-encoded content of the BAT scaled map FITS file. The raw binary packet (bin[22–38]) contains only the filename portion of the URL pointing to this file; the base64-encoded file content is populated during GCN ground processing."
    },

    "watchdog_timeout": {
      "type": "boolean",
      "description": "Indicates whether this BAT_SCALED_MAP notice was forced out early via the watchdog timeout mechanism rather than completing normally. Derived from misc bit 2^29."
    },

    "star_tracker_locked": {
      "type": "boolean",
      "description": "Indicates whether the StarTracker was locked at the time of the BAT trigger. True = locked; False = not locked (trigger is probably bogus). Derived from soln_status bit 2^10 (st_loss_lock) via lookup table. Only valid if misc bit 2^24 is set."
    }

  },

  "required": [
    "alert_datetime",
    "alert_tense",
    "alert_type",
    "mission",
    "instrument",
    "id",
    "trigger_time",
    "ra",
    "dec",
    "ra_dec_error",
    "systematic_included",
    "ra_pointing",
    "dec_pointing",
    "latitude",
    "longitude",
    "trigger_type",
    "rate_snr",
    "image_snr",
    "observation_start",
    "scaled_map_fits_file",
    "watchdog_timeout",
    "star_tracker_locked"
  ],

  "additionalProperties": false
}
