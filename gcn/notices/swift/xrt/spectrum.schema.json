{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gcn.nasa.gov/schema/main/swift/xrt/spectrum.schema.json",
  "title": "swift.xrt.spectrum",
  "description": "GCN Notice schema for Swift XRT spectrum notices (packet types 68 and 77: SWIFT_XRT_SPEC and SWIFT_XRT_SPEC_PROC). The XRT spectrum notice is issued when the XRT has accumulated sufficient data to generate a spectrum FITS file for the trigger. Type=68 is the raw flight notice; type=77 is the ground-processed notice. Both types share an identical packet word layout. bin[7-8] contain the XRT boresight RA/Dec (ra_pointing/dec_pointing); bin[5-6] the spectrum start time (observation_start); bin[9] the livetime (observation_livetime); bin[10-11] the spectrum stop time (observation_stop); bin[21] the termination condition code.",
  "type": "object",
  "allOf": [
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Alert.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/DateTime.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Reporter.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Event.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Pointing.schema.json" }
  ],
  "properties": {

    "ccd_readout_mode": {
      "type": "string",
      "enum": [
        "Null",
        "Short image",
        "Long image",
        "Piled-up Photodiode",
        "Low Rate Photodiode",
        "Windowed Timing",
        "Photo-counting",
        "Raw data",
        "Bias map",
        "Stop"
      ],
      "description": "XRT CCD readout mode active during the spectrum integration. Decoded from the mode field (bin[12])."
    },

    "ccd_waveform_id": {
      "type": "integer",
      "description": "XRT CCD waveform identifier number (typically 50 or 60). Derived from the waveform field (bin[13]). Specifies the CCD clocking waveform used during the observation."
    },

    "amplifier_gain": {
      "type": "integer",
      "enum": [1, 2, 4, 8, 16],
      "description": "XRT CCD amplifier gain setting as a multiplicative factor. Not directly available as a standalone field in the spectrum packet — derived from the gain sub-field packed in bin[12] (mode) or bin[13] (waveform) depending on implementation."
    },

    "bias": {
      "type": "integer",
      "description": "XRT CCD bias level in ADU (Analogue-to-Digital Units). Derived from the bias field (bin[14]). Used in CCD calibration to establish the baseline signal level."
    },

    "termination_condition": {
      "type": "string",
      "enum": [
        "Normal",
        "Terminated by time",
        "Terminated by snapshot",
        "Terminated by entering SAA"
      ],
      "description": "Condition that caused the XRT spectrum accumulation to terminate. Decoded from the term_code field (bin[21])."
    },

    "subtype": {
      "type": "string",
      "enum": ["FLIGHT", "GROUND"],
      "description": "Indicates whether this notice was generated from raw flight telemetry ('FLIGHT', type=68) or from ground reprocessing ('GROUND', type=77). Derived from misc bit 2^30: 0 = FLIGHT, 1 = GROUND."
    },

    "watchdog_timeout": {
      "type": "boolean",
      "description": "Indicates whether this XRT spectrum notice was forced out early via the watchdog timeout mechanism rather than completing normally. Derived from misc bit 2^29."
    },

    "spectrum_fits_file": {
      "type": "string",
      "contentEncoding": "base64",
      "contentMediaType": "image/fits",
      "description": "Base64-encoded content of the XRT spectrum FITS file. The raw binary packet (bin[22–38]) contains only the filename portion of the URL pointing to this file; the base64-encoded file content is populated during GCN ground processing."
    }

  },

  "required": [
    "ccd_readout_mode",
    "ccd_waveform_id",
    "amplifier_gain",
    "bias",
    "termination_condition",
    "subtype",
    "watchdog_timeout",
    "spectrum_fits_file"
  ],

  "additionalProperties": false
}