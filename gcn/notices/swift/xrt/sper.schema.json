{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gcn.nasa.gov/schema/main/swift/xrt/sper.schema.json",
  "title": "swift.xrt.sper",
  "description": "GCN Notice schema for Swift XRT Single Pixel Event Rate (SPER) notices (packet types 87 and 88: SWIFT_XRT_SPER and SWIFT_XRT_SPER_PROC). Not available to the public — Swift team only. The SPER notice is issued when the XRT has accumulated a set of single-pixel events during a follow-up observation. Type=87 is the raw flight notice; type=88 is the ground-processed notice. NOTE: bin[12] has different meanings between the two types — num_pkt (number of packets in the integration) for type=87, and seq_num (serial number of this message, 1-3) for type=88.",
  "type": "object",
  "allOf": [
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Alert.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/DateTime.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Pointing.schema.json" }
  ],
  "properties": {

    "alert_datetime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string indicating when this GCN notice was issued."
    },

    "alert_tense": {
      "type": "string",
      "enum": ["current", "test"],
      "description": "Indicates whether this is a real current notice ('current') or a test submission ('test')."
    },

    "alert_type": {
      "type": "string",
      "enum": ["initial", "update"],
      "description": "Indicates whether this is the initial SPER notice ('initial') for the trigger, or a ground-reprocessed update ('update'). Type=87 (raw flight) maps to 'initial'; type=88 (ground-processed) maps to 'update', indicated by misc bit 2^30."
    },

    "mission": {
      "type": "string",
      "const": "Swift",
      "description": "Fixed string identifying the mission."
    },

    "instrument": {
      "type": "string",
      "const": "XRT",
      "description": "Fixed string identifying the instrument."
    },

    "id": {
      "type": "array",
      "items": {
        "type": "integer"
      },
      "description": "BAT trigger ID number that initiated the XRT follow-up observation. Derived from the lower 24 bits of trig_obs_num (bin[4])."
    },

    "pointing_ra": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 360.0,
      "description": "Right Ascension of the XRT boresight pointing direction, in degrees (J2000 epoch). Derived from point_ra (bin[7]) converted from 0.0001-deg units."
    },

    "pointing_dec": {
      "type": "number",
      "minimum": -90.0,
      "maximum": 90.0,
      "description": "Declination of the XRT boresight pointing direction, in degrees (J2000 epoch). Derived from point_dec (bin[8]) converted from 0.0001-deg units."
    },

    "observation_start": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string of the start of the XRT SPER integration. Derived from burst_tjd (bin[5]) and burst_sod (bin[6])."
    },

    "observation_stop": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime string of the stop time of the XRT SPER integration. Derived from stop_date (bin[10]) and stop_time (bin[11])."
    },

    "observation_livetime": {
      "type": "number",
      "minimum": 0.0,
      "description": "Exposure livetime of the XRT SPER integration in seconds. Derived from expo_time (bin[9]) converted from 0.001-sec units (i.e. value × 1e-3)."
    },

    "number_packets": {
      "type": ["integer", "null"],
      "minimum": 1,
      "description": "Number of telemetry packets that went into compiling this SPER integration. Derived from num_pkt (bin[12]). Only valid for the raw flight notice (type=87); bin[12] contains the message serial number (seq_num, range 1-3) for the ground-processed notice (type=88), so this field is null for type=88."
    },

    "number_events": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of single-pixel events accumulated during the SPER integration interval. Derived from num_evt (bin[20])."
    },

    "watchdog_timeout": {
      "type": "boolean",
      "description": "Indicates whether this XRT SPER notice was forced out early via the watchdog timeout mechanism rather than completing normally. Derived from misc bit 2^29."
    },

    "subtype": {
      "type": "string",
      "enum": ["FLIGHT", "GROUND"],
      "description": "Indicates whether this notice was generated from raw flight telemetry ('FLIGHT', type=87) or from ground reprocessing ('GROUND', type=88). Derived from misc bit 2^30: 0 = FLIGHT, 1 = GROUND."
    },

    "sper_fits_file": {
      "type": "string",
      "contentEncoding": "base64",
      "contentMediaType": "image/fits",
      "description": "Base64-encoded content of the XRT SPER FITS file. The raw binary packet (bin[22–38]) contains only the filename portion of the URL pointing to this file; the base64-encoded file content is populated during GCN ground processing."
    }

  },

  "required": [
    "alert_datetime",
    "alert_tense",
    "alert_type",
    "mission",
    "instrument",
    "id",
    "pointing_ra",
    "pointing_dec",
    "observation_start",
    "observation_stop",
    "observation_livetime",
    "number_packets",
    "number_events",
    "watchdog_timeout",
    "subtype",
    "sper_fits_file"
  ],

  "additionalProperties": false
}
