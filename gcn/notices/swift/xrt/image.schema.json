{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gcn.nasa.gov/schema/main/swift/xrt/image.schema.json",
  "title": "swift.xrt.image",
  "description": "GCN Notice schema for Swift XRT image notices (packet types 69 and 78: SWIFT_XRT_IMAGE and SWIFT_XRT_IMAGE_PROC). The XRT image notice is issued when the XRT has accumulated sufficient data to generate a CCD image for the trigger. Type=69 is the raw flight notice; type=78 is the ground-processed notice.",
  "type": "object",
  "allOf": [
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Alert.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/DateTime.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Reporter.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Event.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Localization.schema.json" },
    { "$ref": "https://gcn.nasa.gov/schema/main/gcn/notices/core/Pointing.schema.json" }
  ],
  "properties": {

    "ccd_readout_mode": {
      "type": "string",
      "enum": [
        "Null",
        "Short image",
        "Long image",
        "Piled-up Photodiode",
        "Low Rate Photodiode",
        "Windowed Timing",
        "Photo-counting",
        "Raw data",
        "Bias map",
        "Stop"
      ],
      "description": "XRT CCD readout mode active during the image integration. Decoded from the mode field packed in bin[17] (gain/mod/wav). Determines the type of CCD data product."
    },

    "ccd_waveform_id": {
      "type": "integer",
      "description": "XRT CCD waveform identifier number (typically 50 or 60). Decoded from the waveform field packed in bin[17] (gain/mod/wav). Specifies the CCD clocking waveform used during the observation."
    },

    "amplifier_gain": {
      "type": "integer",
      "enum": [1, 2, 4, 8, 16],
      "description": "XRT CCD amplifier gain setting as a multiplicative factor. Decoded from the gain field packed in bin[17] (gain/mod/wav)."
    },

    "bright_pixels": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of pixels in the XRT CCD image that exceed the bright pixel threshold. Derived from centroid_cnt (bin[9])."
    },

    "centroid_position": {
      "type": "array",
      "items": { "type": "number" },
      "minItems": 2,
      "maxItems": 2,
      "description": "Centroid position of the brightest source in the XRT CCD image in sub-pixel detector coordinates [x, y], in units of centi-pixels. Derived from cent_x (bin[12]) and cent_y (bin[13]), each converted from centi-pixel units (value × 1e-2)."
    },

    "centroid_ccd_position": {
      "type": "array",
      "items": { "type": "integer" },
      "minItems": 2,
      "maxItems": 2,
      "description": "Center of the 51×51 pixel postage stamp image in integer detector coordinates [x, y]. Derived from iraw_x (bin[14]) and iraw_y (bin[15])."
    },

    "grb_xrt_coordinates": {
      "type": "array",
      "items": { "type": "number" },
      "minItems": 2,
      "maxItems": 2,
      "description": "Position of the GRB afterglow in XRT detector coordinates [y, z] in units of centi-pixels. Derived from grb_in_xrt_y (bin[20]) and grb_in_xrt_z (bin[21]), each converted from centi-pixel units (value × 1e-2)."
    },

    "subtype": {
      "type": "string",
      "enum": ["FLIGHT", "GROUND"],
      "description": "Indicates whether this notice was generated from raw flight telemetry ('FLIGHT', type=69) or from ground reprocessing ('GROUND', type=78). Derived from misc bit 2^30: 0 = FLIGHT, 1 = GROUND."
    },

    "watchdog_timeout": {
      "type": "boolean",
      "description": "Indicates whether this XRT image notice was forced out early via the watchdog timeout mechanism rather than completing normally. Derived from misc bit 2^29."
    },

    "image_fits_file": {
      "type": "string",
      "contentEncoding": "base64",
      "contentMediaType": "image/fits",
      "description": "Base64-encoded content of the XRT CCD image FITS file. The raw binary packet (bin[22–38]) contains only the filename portion of the URL pointing to this file; the base64-encoded file content is populated during GCN ground processing."
    }

  },

  "required": [
    "ccd_readout_mode",
    "ccd_waveform_id",
    "amplifier_gain",
    "bright_pixels",
    "centroid_position",
    "centroid_ccd_position",
    "grb_xrt_coordinates",
    "subtype",
    "watchdog_timeout",
    "image_fits_file"
  ],

  "additionalProperties": false
}